# ============================================================
# DASHBOARD STATISTICHE RISCALDAMENTO
# ============================================================
#
# Aggiungi questa vista al tuo Lovelace dashboard
# per visualizzare lo storico delle ore di riscaldamento
#
# ============================================================

type: vertical-stack
title: ðŸ“Š Statistiche Riscaldamento - Soggiorno
cards:
  # --- RIEPILOGO OGGI ---
  - type: entities
    title: ðŸ”¥ Riscaldamento Oggi
    entities:
      - entity: input_number.heating_hours_soggiorno
        name: Ore oggi
        icon: mdi:fire
      - entity: sensor.heating_usage_percentage_soggiorno
        name: Utilizzo
      - entity: sensor.heating_cost_daily_soggiorno
        name: Costo stimato
      - type: divider
      - entity: climate.termosifone_soggiorno
        name: Valvola
      - entity: input_text.heating_start_soggiorno
        name: Ultimo avvio

  # --- GRAFICO STORICO 7 GIORNI ---
  - type: statistics-graph
    title: ðŸ“ˆ Ore Riscaldamento - Ultimi 7 Giorni
    entities:
      - sensor.heating_daily_soggiorno
    stat_types:
      - state
    chart_type: bar
    period:
      calendar:
        period: day
        offset: -7

  # --- GRAFICO STORICO MENSILE ---
  - type: statistics-graph
    title: ðŸ“ˆ Ore Riscaldamento - Ultimi 3 Mesi
    entities:
      - sensor.heating_monthly_soggiorno
    stat_types:
      - state
      - mean
    chart_type: line
    period:
      calendar:
        period: month
        offset: -3

  # --- CONFRONTO PERIODI ---
  - type: horizontal-stack
    cards:
      - type: statistic
        entity: sensor.heating_daily_soggiorno
        period:
          calendar:
            period: day
        stat_type: mean
        name: Media Giornaliera
        unit: h
        icon: mdi:calendar-today

      - type: statistic
        entity: sensor.heating_weekly_soggiorno
        period:
          calendar:
            period: week
        stat_type: state
        name: Questa Settimana
        unit: h
        icon: mdi:calendar-week

      - type: statistic
        entity: sensor.heating_monthly_soggiorno
        period:
          calendar:
            period: month
        stat_type: state
        name: Questo Mese
        unit: h
        icon: mdi:calendar-month

  # --- GRAFICO A TORTA - DISTRIBUZIONE ANNUALE ---
  - type: custom:apexcharts-card
    header:
      title: ðŸ¥§ Distribuzione Ore - Ultimi 6 Mesi
      show: true
    chart_type: donut
    series:
      - entity: sensor.heating_monthly_soggiorno
        name: Soggiorno
        data_generator: |
          return entity.attributes.history.slice(-6).map((item) => {
            return [new Date(item.end), item.state];
          });

  # --- TABELLA STORICO DETTAGLIATO ---
  - type: custom:auto-entities
    card:
      type: entities
      title: ðŸ“‹ Storico Dettagliato
    filter:
      include:
        - entity_id: sensor.heating_*_soggiorno
          options:
            secondary_info: last-changed
    sort:
      method: last_changed
      reverse: true

  # --- GRAFICO COSTI MENSILI ---
  - type: statistics-graph
    title: ðŸ’° Costi Riscaldamento - Ultimi 6 Mesi
    entities:
      - sensor.heating_cost_daily_soggiorno
    stat_types:
      - sum
    chart_type: bar
    period:
      calendar:
        period: month
        offset: -6

  # --- CARD CONFRONTO MULTI-VALVOLA (se hai piÃ¹ valvole) ---
  - type: statistics-graph
    title: ðŸ”¥ Confronto Tutte le Valvole - Questo Mese
    entities:
      - sensor.heating_monthly_soggiorno
      - sensor.heating_monthly_camera
      - sensor.heating_monthly_bagno
      - sensor.heating_monthly_cucina
    stat_types:
      - state
    chart_type: bar
    period:
      calendar:
        period: month

  # --- CARD ENERGY DASHBOARD (se configurato) ---
  - type: energy-date-selection
  - type: energy-sources-table
  - type: energy-usage-graph
    title: Consumo Energetico Riscaldamento

# ============================================================
# CARD ALTERNATIVE (piÃ¹ semplici, senza custom components)
# ============================================================

# --- GRAFICO MARKDOWN CON EMOJI ---
# - type: markdown
#   title: ðŸ“Š Riepilogo Riscaldamento
#   content: |
#     ### Oggi: {{ states('input_number.heating_hours_soggiorno') }}h
#
#     **Questa settimana:** {{ states('sensor.heating_weekly_soggiorno') }}h
#     **Questo mese:** {{ states('sensor.heating_monthly_soggiorno') }}h
#     **Quest'anno:** {{ states('sensor.heating_yearly_soggiorno') }}h
#
#     ---
#
#     ðŸ’° **Costo stimato oggi:** â‚¬{{ states('sensor.heating_cost_daily_soggiorno') }}
#     ðŸ“ˆ **Media giornaliera:** {{ states('sensor.heating_avg_daily_soggiorno') }}h

# --- MINI GRAPH CARD (se installato) ---
# - type: custom:mini-graph-card
#   entities:
#     - entity: sensor.heating_daily_soggiorno
#       name: Ore Giornaliere
#   hours_to_show: 168  # 7 giorni
#   points_per_hour: 0.25
#   show:
#     labels: true
#     icon: false

# --- HISTORY GRAPH (nativo HA) ---
# - type: history-graph
#   title: Storico 7 Giorni
#   entities:
#     - entity: input_number.heating_hours_soggiorno
#   hours_to_show: 168
